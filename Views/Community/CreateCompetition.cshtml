@model ScheduleCompetitionViewModel
@using FYP_QS_CODE.Models
@{
    ViewData["Title"] = "Create Competition Schedule";
}

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Create Competition</h3>
        <button type="button" class="btn btn-outline-secondary" onclick="confirmExit()">Back</button>
    </div>

    <form asp-action="CreateCompetition" method="post">
        @Html.AntiForgeryToken()
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        @* --- General Info --- *@
        <h5 class="mt-4">General Information</h5>
        <div class="mb-3">
            <label asp-for="GameName" class="form-label"></label>
            <input asp-for="GameName" type="text" maxlength="100" class="form-control"/>
            <span asp-validation-for="GameName" class="text-danger"></span>
        </div>
        @* REMOVED Event Tag Select *@
         <div class="mb-3">
            <label asp-for="Description" class="form-label"></label>
            <textarea asp-for="Description" class="form-control" rows="3"></textarea>
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>

        @* --- Schedule --- *@
        <h5 class="mt-4">Schedule</h5>
         <div class="mb-3">
            <label asp-for="Location" class="form-label"></label>
            <input asp-for="Location" type="text" class="form-control"/>
            <span asp-validation-for="Location" class="text-danger"></span>
        </div>
        <div class="row">
             <div class="col-md-6 mb-3">
                <label asp-for="StartTime" class="form-label"></label>
                <input asp-for="StartTime" type="datetime-local" class="form-control"/>
                <span asp-validation-for="StartTime" class="text-danger"></span>
            </div>
             <div class="col-md-6 mb-3">
                <label asp-for="EndTime" class="form-label"></label>
                <input asp-for="EndTime" type="datetime-local" class="form-control"/>
                <span asp-validation-for="EndTime" class="text-danger"></span>
            </div>
        </div>
        <div class="mb-3">
            <label asp-for="ApproxStartTime" class="form-label"></label>
            <input asp-for="ApproxStartTime" type="datetime-local" class="form-control"/>
            <span asp-validation-for="ApproxStartTime" class="text-danger"></span>
        </div>


        @* --- Registration --- *@
        <h5 class="mt-4">Registration</h5>
        <div class="row">
             <div class="col-md-6 mb-3">
                <label asp-for="RegOpen" class="form-label"></label>
                <input asp-for="RegOpen" type="datetime-local" class="form-control"/>
                <span asp-validation-for="RegOpen" class="text-danger"></span>
            </div>
             <div class="col-md-6 mb-3">
                <label asp-for="RegClose" class="form-label"></label>
                <input asp-for="RegClose" type="datetime-local" class="form-control"/>
                <span asp-validation-for="RegClose" class="text-danger"></span>
            </div>
        </div>
         <div class="mb-3">
            <label asp-for="EarlyBirdClose" class="form-label"></label>
            <input asp-for="EarlyBirdClose" type="datetime-local" class="form-control"/>
            <span asp-validation-for="EarlyBirdClose" class="text-danger"></span>
        </div>

        @* --- Participation & Fees --- *@
        <h5 class="mt-4">Participation & Fees</h5>
         <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="NumTeam" class="form-label"></label>
                <input asp-for="NumTeam" type="number" class="form-control"/>
                <span asp-validation-for="NumTeam" class="text-danger"></span>
            </div>
             <div class="col-md-6 mb-3">
                <label asp-for="FeeType" class="form-label"></label>
                @* --- MODIFIED Fee Type Select --- *@
                <select asp-for="FeeType" class="form-select" id="feeSelect" onchange="toggleFeeInput()">
                    @* Manually specify options. Value corresponds to the FeeType enum integer *@
                    <option value="@((int)FeeType.Free)">Free</option>
                    <option value="@((int)FeeType.PerPerson)">Per Team</option> @* Display "Per Team", Value maps to PerPerson *@
                </select>
                <span asp-validation-for="FeeType" class="text-danger"></span>
            </div>
        </div>
         <div id="feeInput" class="mb-3" style='display:@(Model.FeeType == FeeType.PerPerson ? "block" : "none");'> @* Adjust initial display based on default *@
            <label asp-for="FeeAmount" class="form-label"></label> @* Label text updated in ViewModel *@
            <input asp-for="FeeAmount" type="number" class="form-control" placeholder="Enter price per team (RM)" step="0.01"/>
            <span asp-validation-for="FeeAmount" class="text-danger"></span>
        </div>


        @* --- Competition Format --- *@
        <h5 class="mt-4">Competition Format</h5>
        <div class="mb-3">
            <label asp-for="Format" class="form-label"></label>
             <select asp-for="Format" class="form-select" asp-items="Html.GetEnumSelectList<CompetitionFormat>()"></select>
             <span asp-validation-for="Format" class="text-danger"></span>
        </div>


        @* --- Restrictions --- *@
        <h5 class="mt-4">Restrictions</h5>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="MinRankRestriction" class="form-label"></label>
                <input asp-for="MinRankRestriction" type="number" class="form-control" step="0.01"/>
                <span asp-validation-for="MinRankRestriction" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-3">
                <label asp-for="MaxRankRestriction" class="form-label"></label>
                <input asp-for="MaxRankRestriction" type="number" class="form-control" step="0.01"/>
                <span asp-validation-for="MaxRankRestriction" class="text-danger"></span>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 mb-3">
                <label asp-for="GenderRestriction" class="form-label"></label>
                <select asp-for="GenderRestriction" class="form-select" asp-items="Html.GetEnumSelectList<GenderRestriction>()"></select>
                <span asp-validation-for="GenderRestriction" class="text-danger"></span>
            </div>
            <div class="col-md-6 mb-3">
                <label asp-for="AgeGroupRestriction" class="form-label"></label>
                <select asp-for="AgeGroupRestriction" class="form-select" asp-items="Html.GetEnumSelectList<AgeGroupRestriction>()"></select>
                <span asp-validation-for="AgeGroupRestriction" class="text-danger"></span>
            </div>
        </div>

        @* --- Advanced Options --- *@
        <h5 class="mt-4">Advanced Options</h5>
         <div class="row">
             <div class="col-md-6 mb-3">
                <label asp-for="CancellationFreeze" class="form-label"></label>
                <select asp-for="CancellationFreeze" class="form-select" asp-items="Html.GetEnumSelectList<CancellationFreeze>()"></select>
                <span asp-validation-for="CancellationFreeze" class="text-danger"></span>
            </div>
             @* REMOVED HostRole Select *@
             <div class="col-md-6 mb-3">
                 <label asp-for="Privacy" class="form-label"></label>
                 <select asp-for="Privacy" class="form-select" asp-items="Html.GetEnumSelectList<Privacy>()"></select>
                 <span asp-validation-for="Privacy" class="text-danger"></span>
             </div>
         </div>


        <button type="submit" class="btn btn-success w-100 py-2 mt-3">Create & Setup Matches</button>
    </form>
</div>

@section Scripts {
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
    <script>
        // --- Fee Toggle Script ---
        function toggleFeeInput(){
            const feeSelect = document.getElementById("feeSelect");
            const feeInput = document.getElementById("feeInput");
             // Value for PerPerson enum member (representing "Per Team")
             const perTeamValue = "@((int)FeeType.PerPerson)";
             if(feeSelect.value === perTeamValue){
                feeInput.style.display = "block";
            } else {
                feeInput.style.display = "none";
                const feeAmountInput = feeInput.querySelector('input');
                 if(feeAmountInput) { feeAmountInput.value = ''; }
            }
        }
        document.addEventListener("DOMContentLoaded", toggleFeeInput);

        // --- Exit Confirmation Script ---
         function confirmExit() { /* ... keep existing ... */ }

         // --- Future Time Validation Script ---
         document.addEventListener("DOMContentLoaded", function() { /* ... keep existing ... */ });
    </script>
}